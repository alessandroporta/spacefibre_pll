; Top Design: "spacefiber_pll_lib:pll_cp_real:schematic"
; Netlisted using Hierarchy Policy: "Standard_ic"

Options ResourceUsage=yes UseNutmegFormat=no EnableOptim=no TopDesignName="spacefiber_pll_lib:pll_cp_real:schematic" DcopOutputNodeVoltages=yes DcopOutputPinCurrents=yes DcopOutputAllSweepPoints=no DcopOutputDcopType=0
simulator lang = spectre
global 0 sub!
simulator lang = ads
; Library Name: spacefiber_pll_lib
; Cell Name: OpAmp
; View Name: schematic
define OpAmp ( Vpos  Vneg  Vout  Vdd  Vss ) 
;parameters 
simulator lang = spectre
P6 (Vout N__3 Vdd sub_n) pmos w=48u l=500n ng=48 rfmode=0 ad=0 as=0 pd=0 ps=0 m=2
P5 (N__3 N__3 Vdd sub_n) pmos w=48u l=500n ng=48 rfmode=0 ad=0 as=0 pd=0 ps=0 m=2
N12 (Vout Vneg N__16 sub!) nmos w=2u l=500n ng=2 rfmode=0 ad=0 as=0 pd=0 ps=0 m=2
N11 (N__3 Vpos N__16 sub!) nmos w=2u l=500n ng=2 rfmode=0 ad=0 as=0 pd=0 ps=0 m=2
N10 (N__16 N__28 Vss sub!) nmos w=10u l=500n ng=10 rfmode=0 ad=0 as=0 pd=0 ps=0 m=2
simulator lang = ads
I_Source:SRC1  Vdd N__28 Type="I_DC" Idc=15 uA 
simulator lang = spectre
global 0 sub!
include "C:/PDK_ADS/sg25h4_students/tech/spectre/mismatch.scs"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/cornerDIO.scs" section=11
include "C:/PDK_ADS/sg25h4_students/tech/SG25_MOS/library/spectre/cornerMOS_psp.scs" section=tt
include "C:/PDK_ADS/sg25h4_students/tech/SG25H4_HBT/spectre/cornerBIP.scs" section=typ
include "C:/PDK_ADS/sg25h4_students/tech/spectre/cornerRES.scs" section=11
include "C:/PDK_ADS/sg25h4_students/tech/spectre/cornerCAP.scs" section=11
include "C:/PDK_ADS/sg25h4_students/tech/spectre/cornerRCX.scs" section=11
include "C:/PDK_ADS/sg25h4_students/tech/spectre/statistics.scs"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/SG25H4_parameters.scs"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/SG25_passives.lib"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/SG25_inductors.lib"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/SG25_diodes.lib"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/SG25_esd.lib"
N9 (N__28 N__28 Vss sub!) nmos w=10u l=500n ng=10 rfmode=0 ad=0 as=0 pd=0 ps=0 m=2
X3 (sub! 0) ptap1 R=262.847 l=780n w=780n
X5 (Vdd sub_n) ntap1 R=262.847 l=780n w=780n
simulator lang = ads
end OpAmp

; Library Name: ads_behavioral
; Cell Name: PhaseFreqDet2
; View Name: schematic
define PhaseFreqDet2 ( N__0  N__5  N__6  N__4  N__3  N__2 ) 
parameters  Vhigh=5 V  Vlow=0 V  DeadTime=0 psec  Jitter=0 psec 
FDD:FDD6P1  N__0 0 N__6 0 N__5 0 N__4 0 N__3 0 N__2 0  I[1,0]=0.0  V[2,0]=Vlow + n1  I[3,0]=0.0  V[4,0]=Vhigh - n2  V[5,0]=Vhigh - n1  V[6,0]=Vlow + n2  Trig[1]=_xcross(1,0.5,1)  Trig[2]=_xcross(3,0.5,1) + setDT(0.0) 

ns=_phase_freq(1,2,DeadTime,Jitter)
n1=(Vhigh-Vlow)*real(ns)
n2=(Vhigh-Vlow)*imag(ns)
end PhaseFreqDet2

; Library Name: spacefiber_pll_lib
; Cell Name: charge_pump
; View Name: schematic
define charge_pump ( Qa  Qa_n  Qb  Qb_n  Vdd  Vd ) 
;parameters 
simulator lang = spectre
X18 (Vdd sub_n) ntap1 R=262.847 l=780n w=780n
simulator lang = ads
OpAmp:X16  Vd N__53 N__53 Vdd 0 
simulator lang = spectre
N18 (Vd Qb Vs sub!) nmos w=2u l=960n ng=2 rfmode=0 ad=0 as=0 pd=0 ps=0 m=1
N19 (N__53 Qb_n Vs sub!) nmos w=2u l=960n ng=2 rfmode=0 ad=0 as=0 pd=0 ps=0 m=1
X2 (sub! 0) ptap1 R=262.847 l=780n w=780n
global 0 sub!
include "C:/PDK_ADS/sg25h4_students/tech/spectre/mismatch.scs"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/cornerDIO.scs" section=11
include "C:/PDK_ADS/sg25h4_students/tech/SG25_MOS/library/spectre/cornerMOS_psp.scs" section=tt
include "C:/PDK_ADS/sg25h4_students/tech/SG25H4_HBT/spectre/cornerBIP.scs" section=typ
include "C:/PDK_ADS/sg25h4_students/tech/spectre/cornerRES.scs" section=11
include "C:/PDK_ADS/sg25h4_students/tech/spectre/cornerCAP.scs" section=11
include "C:/PDK_ADS/sg25h4_students/tech/spectre/cornerRCX.scs" section=11
include "C:/PDK_ADS/sg25h4_students/tech/spectre/statistics.scs"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/SG25H4_parameters.scs"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/SG25_passives.lib"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/SG25_inductors.lib"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/SG25_diodes.lib"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/SG25_esd.lib"
P15 (N__53 Qa N__74 sub_n) pmos w=4u l=480n ng=4 rfmode=0 ad=0 as=0 pd=0 ps=0 m=1
P17 (Vd Qa_n N__74 sub_n) pmos w=4u l=480n ng=4 rfmode=0 ad=0 as=0 pd=0 ps=0 m=1
simulator lang = ads
I_Source:SRC1  Vdd N__74 Type="I_DC" Idc=40 uA 
I_Source:SRC2  Vs 0 Type="I_DC" Idc=40 uA 
end charge_pump

; Library Name: spacefiber_pll_lib
; Cell Name: loop_filter
; View Name: schematic
define loop_filter ( Vout  Vout__Vout  gnd ) 
;parameters 
R:R1  Vout N__2 R=R Noise=yes 
C:C2  Vout gnd C=C2 
C:C1  N__2 gnd C=C1 

R=12KOhm
C1=8 pF
C2=1 pF
Short:PinShort__Vout  Vout__Vout Vout Mode=0 SaveCurrent=no
end loop_filter

#uselib "sml" , "VCO_DivideByN"
VCO_DivideByN:VCO1  Vd 0 Vvco_div VCO_CL freq_vco_CL VCO_Freq=2 GHz * _v1 F0=5.95 GHz N=40 Rout=50 Ohm Power=dbmtow(0) Delay=0 

HB:Env1 Freq[1]=fvco \
 Order[1]=1 \
  MaxOrder=0 StatusLevel=1 FundOversample=2 UseGear=yes EnvIntegOrder=2 \
 EnvBandwidth=1 EnvWarnPoorFit=yes EnvUsePoorFit=yes SweepVar="time" DevOpPtLevel=0 \
 EnvFitDisableCache=no SweepPlan="Env1_stim" OutputPlan="Env1_Output"

OutputPlan:Env1_Output \
       Type="Output" \
       UseNodeNestLevel=yes \
       NodeNestLevel=2 \
       UseEquationNestLevel=yes \
       EquationNestLevel=2 \
       UseSavedEquationNestLevel=yes \
       SavedEquationNestLevel=2 \
       UseDeviceCurrentNestLevel=no \
       DeviceCurrentNestLevel=0 \
       DeviceCurrentDeviceType="All" \
       DeviceCurrentSymSyntax=yes \
       UseCurrentNestLevel=yes \
       CurrentNestLevel=999 \
       UseDeviceVoltageNestLevel=no \
       DeviceVoltageNestLevel=0 \
       DeviceVoltageDeviceType="All" 

SweepPlan:Env1_stim Stop=tstop Step=1 nsec

Tran:Env1_tran HB_Sol=1 SteadyState=1 StatusLevel=3 \
 Freq[1]=fvco \
 Order[1]=1 \
 OutputPlan="Env1_Output"

Component:tahb_Env1 Module="ATAHB" Type="ModelExtractor" Tran_Analysis="Env1_tran" HB_Analysis="Env1"

loop_filter:X5  N__18 Vd 0 
#uselib "sml" , "PM_DemodTuned"
PM_DemodTuned:DEMOD1  VCO_CL PN_CL Sensitivity=180/pi Fnom=fvco Rout=50 Ohm 
V_Source:SRC1  Vref 0 Type="V_DC" Vdc=Vref SaveCurrent=1 

fref=156.25 MHz
tstop=100 usec
fvco=6.25 GHz
Vref=phaserad(-exp(j*2*pi*fref*time))
PhaseFreqDet2:PFD2  Vref Vvco_div N__15 N__0 N__12 N__4 Vhigh=2.5 V Vlow=0 V DeadTime=0 psec Jitter=0 psec 
V_Source:SRC2  Vdd 0 Type="V_DC" Vdc=2.5 V SaveCurrent=1 
charge_pump:X6  N__15 N__12 N__4 N__0 Vdd N__18 
