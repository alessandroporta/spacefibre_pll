; Top Design: "spacefiber_pll_lib:pll_ideal:schematic"
; Netlisted using Hierarchy Policy: "Standard_ic"

Options ResourceUsage=yes UseNutmegFormat=no EnableOptim=no TopDesignName="spacefiber_pll_lib:pll_ideal:schematic" DcopOutputNodeVoltages=yes DcopOutputPinCurrents=yes DcopOutputAllSweepPoints=no DcopOutputDcopType=0
; Library Name: spacefiber_pll_lib
; Cell Name: loop_filter
; View Name: schematic
define loop_filter ( Vin  Vin__Vout  gnd ) 
parameters  R=1k  C1=1000p  C2=100p 
R:R1  Vin N__2 R=R Noise=yes 
C:C2  Vin gnd C=C2 
C:C1  N__2 gnd C=C1 
Short:PinShort__Vout  Vin__Vout Vin Mode=0 SaveCurrent=no
end loop_filter

#uselib "sml" , "PhaseFreqDetCP"
PhaseFreqDetCP:PFD1  Vref VCO_div N__12 N__12 Ihigh=400 uA Ilow=400 uA DeadTime=0 psec Jitter=0 psec 
#uselib "sml" , "VCO_DivideByN"
VCO_DivideByN:VCO1  Vd 0 VCO_div VCO_CL freq_VCO_CL VCO_Freq=2 GHz * _v1 F0=5.95 GHz N=40 Rout=50 Ohm Power=dbmtow(0) Delay=0 

HB:Env1 Freq[1]=fvco \
 Order[1]=1 \
  MaxOrder=0 StatusLevel=1 FundOversample=2 UseGear=yes EnvIntegOrder=2 \
 EnvBandwidth=1 EnvWarnPoorFit=yes EnvUsePoorFit=yes SweepVar="time" DevOpPtLevel=0 \
 EnvFitDisableCache=no SweepPlan="Env1_stim" OutputPlan="Env1_Output"

OutputPlan:Env1_Output \
       Type="Output" \
       UseNodeNestLevel=yes \
       NodeNestLevel=2 \
       UseEquationNestLevel=yes \
       EquationNestLevel=2 \
       UseSavedEquationNestLevel=yes \
       SavedEquationNestLevel=2 \
       UseDeviceCurrentNestLevel=no \
       DeviceCurrentNestLevel=0 \
       DeviceCurrentDeviceType="All" \
       DeviceCurrentSymSyntax=yes \
       UseCurrentNestLevel=yes \
       CurrentNestLevel=999 \
       UseDeviceVoltageNestLevel=no \
       DeviceVoltageNestLevel=0 \
       DeviceVoltageDeviceType="All" 

SweepPlan:Env1_stim Stop=tstop Step=1 nsec

Tran:Env1_tran HB_Sol=1 SteadyState=1 StatusLevel=3 \
 Freq[1]=fvco \
 Order[1]=1 \
 OutputPlan="Env1_Output"

Component:tahb_Env1 Module="ATAHB" Type="ModelExtractor" Tran_Analysis="Env1_tran" HB_Analysis="Env1"

loop_filter:LP_real  N__9 Vd 0 R=1k C1=1000p C2=100p 
#uselib "sml" , "ResetSwitch"
ResetSwitch:SWITCH1  0 Vd 
V_Source:SRC1  Vref 0 Type="V_DC" Vdc=Vref SaveCurrent=1 

fref=156.25 MHz
tstop=6 usec
fvco=6.25 GHz
Vref=phaserad(-exp(j*2*pi*fref*time))
Short:I_CP  N__12 N__9 Mode=0 SaveCurrent=yes 
