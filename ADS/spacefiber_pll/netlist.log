; Top Design: "spacefiber_pll_lib:pll_phase_noise:schematic"
; Netlisted using Hierarchy Policy: "Standard_ic"

Options ResourceUsage=yes UseNutmegFormat=no EnableOptim=no TopDesignName="spacefiber_pll_lib:pll_phase_noise:schematic" DcopOutputNodeVoltages=yes DcopOutputPinCurrents=yes DcopOutputAllSweepPoints=no DcopOutputDcopType=0
simulator lang = spectre
global 0 sub!
simulator lang = ads
; Library Name: spacefiber_pll_lib
; Cell Name: OpAmp
; View Name: schematic
define OpAmp ( Vpos  Vneg  Vout  Vdd  Vss ) 
;parameters 
simulator lang = spectre
P6 (Vout N__3 Vdd sub_n) pmos w=48u l=500n ng=48 rfmode=0 ad=0 as=0 pd=0 ps=0 m=2
P5 (N__3 N__3 Vdd sub_n) pmos w=48u l=500n ng=48 rfmode=0 ad=0 as=0 pd=0 ps=0 m=2
N12 (Vout Vneg N__16 sub!) nmos w=2u l=500n ng=2 rfmode=0 ad=0 as=0 pd=0 ps=0 m=2
N11 (N__3 Vpos N__16 sub!) nmos w=2u l=500n ng=2 rfmode=0 ad=0 as=0 pd=0 ps=0 m=2
N10 (N__16 N__28 Vss sub!) nmos w=10u l=500n ng=10 rfmode=0 ad=0 as=0 pd=0 ps=0 m=2
simulator lang = ads
I_Source:SRC1  Vdd N__28 Type="I_DC" Idc=15 uA 
simulator lang = spectre
global 0 sub!
include "C:/PDK_ADS/sg25h4_students/tech/spectre/mismatch.scs"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/cornerDIO.scs" section=11
include "C:/PDK_ADS/sg25h4_students/tech/SG25_MOS/library/spectre/cornerMOS_psp.scs" section=tt
include "C:/PDK_ADS/sg25h4_students/tech/SG25H4_HBT/spectre/cornerBIP.scs" section=typ
include "C:/PDK_ADS/sg25h4_students/tech/spectre/cornerRES.scs" section=11
include "C:/PDK_ADS/sg25h4_students/tech/spectre/cornerCAP.scs" section=11
include "C:/PDK_ADS/sg25h4_students/tech/spectre/cornerRCX.scs" section=11
include "C:/PDK_ADS/sg25h4_students/tech/spectre/statistics.scs"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/SG25H4_parameters.scs"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/SG25_passives.lib"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/SG25_inductors.lib"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/SG25_diodes.lib"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/SG25_esd.lib"
N9 (N__28 N__28 Vss sub!) nmos w=10u l=500n ng=10 rfmode=0 ad=0 as=0 pd=0 ps=0 m=2
X3 (sub! 0) ptap1 R=262.847 l=780n w=780n
X5 (Vdd sub_n) ntap1 R=262.847 l=780n w=780n
simulator lang = ads
end OpAmp

; Library Name: spacefiber_pll_lib
; Cell Name: PFD
; View Name: schematic
define PFD ( reset_in  ref  div  Vdd  reset_out  Qa  Qb  Qa_n  Qb_n ) 
;parameters 
DFlipFlopPC_P:DFFPC_2  Vdd div 0 reset_in Qb_n Qb Vih=Vdd/2 Voh=Vdd Vol=0 
DFlipFlopPC_P:DFFPC_1  Vdd ref 0 reset_in Qa_n Qa Vih=Vdd/2 Voh=Vdd Vol=0 
AND_P:AND2_1  Qa Qb reset_out Vih=Vdd/2 Voh=Vdd Vol=0 

Vdd=2.5V
end PFD

; Library Name: spacefiber_pll_lib
; Cell Name: charge_pump
; View Name: schematic
define charge_pump ( Qa  Qa_n  Qb  Qb_n  Vdd  Vd ) 
;parameters 
simulator lang = spectre
X18 (Vdd sub_n) ntap1 R=262.847 l=780n w=780n
N21 (Vd Vdd N__51 sub!) nmos w=10u l=240n ng=10 rfmode=0 ad=0 as=0 pd=0 ps=0 m=1
P19 (Vd 0 N__71 sub_n) pmos w=20u l=240n ng=20 rfmode=0 ad=0 as=0 pd=0 ps=0 m=1
simulator lang = ads
OpAmp:X16  Vd N__70 N__70 Vdd 0 
simulator lang = spectre
N18 (N__51 Qb Vs sub!) nmos w=10u l=240n ng=10 rfmode=0 ad=0 as=0 pd=0 ps=0 m=1
P18 (N__70 0 N__73 sub_n) pmos w=20u l=240n ng=20 rfmode=0 ad=0 as=0 pd=0 ps=0 m=1
N19 (N__75 Qb_n Vs sub!) nmos w=10u l=240n ng=10 rfmode=0 ad=0 as=0 pd=0 ps=0 m=1
N23 (Vs N__76 0 sub!) nmos w=20u l=1u ng=20 rfmode=0 ad=0 as=0 pd=0 ps=0 m=1
X2 (sub! 0) ptap1 R=262.847 l=780n w=780n
simulator lang = ads
R:R1  Vdd N__76 R=35000 Ohm Noise=yes 
simulator lang = spectre
P21 (N__57 N__60 Vdd sub_n) pmos w=40u l=1u ng=40 rfmode=0 ad=0 as=0 pd=0 ps=0 m=1
global 0 sub!
include "C:/PDK_ADS/sg25h4_students/tech/spectre/mismatch.scs"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/cornerDIO.scs" section=11
include "C:/PDK_ADS/sg25h4_students/tech/SG25_MOS/library/spectre/cornerMOS_psp.scs" section=tt
include "C:/PDK_ADS/sg25h4_students/tech/SG25H4_HBT/spectre/cornerBIP.scs" section=typ
include "C:/PDK_ADS/sg25h4_students/tech/spectre/cornerRES.scs" section=11
include "C:/PDK_ADS/sg25h4_students/tech/spectre/cornerCAP.scs" section=11
include "C:/PDK_ADS/sg25h4_students/tech/spectre/cornerRCX.scs" section=11
include "C:/PDK_ADS/sg25h4_students/tech/spectre/statistics.scs"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/SG25H4_parameters.scs"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/SG25_passives.lib"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/SG25_inductors.lib"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/SG25_diodes.lib"
include "C:/PDK_ADS/sg25h4_students/tech/spectre/SG25_esd.lib"
P20 (N__60 N__60 Vdd sub_n) pmos w=40u l=1u ng=40 rfmode=0 ad=0 as=0 pd=0 ps=0 m=1
N20 (N__70 Vdd N__75 sub!) nmos w=10u l=240n ng=10 rfmode=0 ad=0 as=0 pd=0 ps=0 m=1
N22 (N__76 N__76 0 sub!) nmos w=2u l=1u ng=2 rfmode=0 ad=0 as=0 pd=0 ps=0 m=1
P15 (N__73 Qa N__57 sub_n) pmos w=20u l=240n ng=20 rfmode=0 ad=0 as=0 pd=0 ps=0 m=1
N24 (N__60 N__76 0 sub!) nmos w=21u l=1u ng=21 rfmode=0 ad=0 as=0 pd=0 ps=0 m=1
P17 (N__71 Qa_n N__57 sub_n) pmos w=20u l=240n ng=20 rfmode=0 ad=0 as=0 pd=0 ps=0 m=1
simulator lang = ads
end charge_pump

; Library Name: spacefiber_pll_lib
; Cell Name: loop_filter
; View Name: schematic
define loop_filter ( Vin  Vin__Vout  gnd ) 
parameters  R=1k  C1=1000p  C2=100p 
R:R1  Vin N__2 R=R Noise=yes 
C:C2  Vin gnd C=C2 
C:C1  N__2 gnd C=C1 
Short:PinShort__Vout  Vin__Vout Vin Mode=0 SaveCurrent=no
end loop_filter

charge_pump:CP_real  Qa Qa_n Qb Qb_n Vdd N__9 
Short:I_CP  N__9 N__3 Mode=0 SaveCurrent=yes 
#uselib "sml" , "ResetSwitch"
ResetSwitch:SWITCH1  0 N__26 
V_Source:SRC1  V_ref 0 Type="V_DC" Vdc=Vref SaveCurrent=1 

fref=156.25 MHz
f0=5.95 GHz
Vdd=2.5V
StopTime=3 usec
fvco=6.25 GHz
Vref=phaserad(-exp(j*2*pi*fref*time))
Kv=2 GHz
TimeStep=0.1/fvco
N=40
PFD:PFD_real  reset V_ref VCO_div Vdd reset Qa Qb Qa_n Qb_n 
V_Source:SRC2  Vdd 0 Type="V_DC" Vdc=Vdd SaveCurrent=1 
Tran:Tran1 StartTime=0.0 nsec StopTime=StopTime MaxTimeStep=TimeStep LimitStepForTL=yes TimeStepControl=2 TruncTol=7.0 ChargeTol=1.0e-14 IntegMethod=0 MaxGearOrder=2 \
Mu=0.5 MaxOrder=4 Freq[1]=1.0 GHz Order[1]=3 HB_Window=no \
HB_Sol=no ImpApprox=no ShortTL_Delay=1.0 psec ImpMode=1 UseInitCond=no \
LoadGminDC=no CheckKCL=yes CheckOnlyDeltaV=yes OverloadAlert=no DeviceBypass=no \
MaxIters=10 MaxItersDC=200 DevOpPtLevel=0 StatusLevel=2 OutputAllPoints=yes \
NoiseScale=1 ImpEnforcePassivity=yes ImpSkipTotalEnergy=1000 ImpLFEOn=yes \
OutputPlan="Tran1_Output" 

OutputPlan:Tran1_Output \
      Type="Output" \
      UseNodeNestLevel=yes \
      NodeNestLevel=2 \
      UseEquationNestLevel=yes \
      EquationNestLevel=2 \
      UseSavedEquationNestLevel=yes \
      SavedEquationNestLevel=2 \
      UseDeviceCurrentNestLevel=no \
      DeviceCurrentNestLevel=0 \
      DeviceCurrentDeviceType="All" \
      DeviceCurrentSymSyntax=yes \
      UseCurrentNestLevel=yes \
      CurrentNestLevel=999 \
      UseDeviceVoltageNestLevel=no \
      DeviceVoltageNestLevel=0 \
      DeviceVoltageDeviceType="All"

#uselib "sml" , "VCO_DivideByN"
VCO_DivideByN:VCO1  Vd 0 VCO_div VCO_CL freq_VCO VCO_Freq=Kv * _v1 F0=f0 N=N Rout=50 Ohm Power=dbmtow(0) Delay=50 nsec 
#uselib "sml" , "VCO"
VCO:VCO2  0 N__8 Kv=Kv Freq=fvco P=-j*dbmtow(0) Rout=50 Ohm Delay=timestep Harmonics=list(0) 
V_Source:SRC3  N__17 0 Type="V_Noise" V_Noise=pn2 SaveCurrent=1 
#uselib "sml" , "PM_ModTuned"
PM_ModTuned:MOD1  N__8 VCO_OL N__17 Sensitivity=180/pi Fnom=fvco Rout=50 Ohm 
#uselib "sml" , "PM_DemodTuned"
PM_DemodTuned:DEMOD1  VCO_OL PN_OL Sensitivity=180/pi Fnom=fvco Rout=50 Ohm 
#uselib "sml" , "FM_DemodTuned"
FM_DemodTuned:DEMOD2  VCO_OL FM_Demod Sensitivity=Kv Fnom=fvco Rout=50 Ohm 
#uselib "ckt" , "VCVS"
VCVS:SRC4  FM_Demod 0 Vd N__26 G=1 T=0.0 nsec R1=1e100 Ohm R2=0 Ohm F=0.0 GHz 
#uselib "ckt" , "DAC"
DAC:DAC_PhNoise  File="REF_PhaseNoise.mdif" Type="gmdif" InterpMode="linear" InterpDom="ri" ExtrapMode="interpMode" iVar1="log_freq" iVal1=log(abs(freq) + 1e-6) 

pn_db=file{DAC_PhNoise, "phnoise"}
pn2=10^(pn_db/20)*sqrt(2)
#uselib "sml" , "PM_DemodTuned"
PM_DemodTuned:DEMOD3  VCO_CL PN_CL Sensitivity=180/pi Fnom=fvco Rout=50 Ohm 
loop_filter:LP_real  N__3 N__26 0 R=1k C1=1000p C2=100p 
